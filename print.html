<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sunshine Recipes</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="pallets/index.html"><strong aria-hidden="true">2.</strong> Pallets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pallets/bounty.html"><strong aria-hidden="true">2.1.</strong> Bounty</a></li><li class="chapter-item expanded "><a href="pallets/org.html"><strong aria-hidden="true">2.2.</strong> Org</a></li></ol></li><li class="chapter-item expanded "><a href="client/index.html"><strong aria-hidden="true">3.</strong> Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="client/embed.html"><strong aria-hidden="true">3.1.</strong> Ipfs-Embed</a></li><li class="chapter-item expanded "><a href="client/keybase.html"><strong aria-hidden="true">3.2.</strong> Keybase</a></li><li class="chapter-item expanded "><a href="client/subxt.html"><strong aria-hidden="true">3.3.</strong> Substrate-Subxt</a></li></ol></li><li class="chapter-item expanded "><a href="open.html"><strong aria-hidden="true">4.</strong> Shared Open Problems</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Sunshine Recipes</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="splash">
   <img src="./images/logo.jpeg" class="splogo" alt="Logo" height="110px"/>
</div>
<div class="drop"></div>
<h2 id="sunshine-recipes"><a class="header" href="#sunshine-recipes">Sunshine Recipes</a></h2>
<p>Welcome! We're building governance infrastructure.</p>
<p>The software stack was carefully chosen to ensure resilience to capture and aspire towards censorship resistance. The blockchain is implemented with <a href="https://github.com/paritytech/substrate">Substrate</a> to take advantage of the cutting edge in distributed network infrastructure. </p>
<p>The network design minimizes on-chain state by storing sensitive data off-chain in <a href="https://github.com/ipfs-rust/ipfs-embed"><code>ipfs-embed</code></a> and only storing content identifiers on-chain. Efficient client-side networks enable the secure sharing of off-chain data among the relevant subscribers.</p>
<p>In a world increasingly fraught by data mismanagement (<em>the Cloud</em>), Sunshine stores all sensitive data on local hardware in an encrypted form. This architecture is conducive to modern key rotation mechanisms and client-side computation. It is inspired by <a href="https://martin.kleppmann.com/papers/local-first.pdf">Local First</a> design principles.</p>
<p>Go to the <em><a href="https://sunshine.foundation">splash</a></em> for high-level details. Now, onwards, <a href="https://github.com/sunshine-protocol">to the code</a> 🚀</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="pallets"><a class="header" href="#pallets">Pallets</a></h1>
<p>All objects and relationships are in <a href="https://github.com/sunshine-protocol/sunshine-bounty/tree/master/utils"><code>./utils</code></a>. Module implementations that conform to the Substrate pallet rules are in <a href="https://github.com/sunshine-protocol/sunshine-bounty/tree/master/pallets"><code>./pallets/*</code></a>.</p>
<p>To learn more about <code>sunshine-bounty</code> design, check out the high-level overviews for core pallets:</p>
<ul>
<li><a href="pallets/org.html">Org</a></li>
<li><a href="pallets/bounty.html">Bounty</a></li>
</ul>
<p>To see more substrate pallet patterns in action, <a href="https://github.com/substrate-developer-hub/recipes">check out the substrate recipes</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="bounty-pallet"><a class="header" href="#bounty-pallet">Bounty Pallet</a></h2>
<p>This pallet placed 3rd 🏆 in <a href="https://hackusama.devpost.com/submissions">Hackusama</a> with a submission that included a custom substrate-subxt client to update github issue information based on changes to chain state.</p>
<h3 id="post-bounties"><a class="header" href="#post-bounties">Post Bounties</a></h3>
<p>Anyone can post bounties as long as the amount is above the module minimum. The module minimum is set in the pallet's <code>Trait</code>.</p>
<pre><code class="language-rust ignore">pub trait Trait {
    ...
    /// Minimum deposit to post bounty
    type MinDeposit: Get&lt;BalanceOf&lt;Self&gt;&gt;;
}
</code></pre>
<p>The public runtime method signature is</p>
<pre><code class="language-rust ignore">fn post_bounty(
    origin,
    issue: EncodedIssue,
    info: T::IpfsReference,
    amount: BalanceOf&lt;T&gt;,
) -&gt; DispatchResult
</code></pre>
<p>The <code>amount</code> is checked against the module constraints. The <code>issue</code> input is the binary encoding of github issue metadata. </p>
<pre><code class="language-rust ignore">type EncodedIssue = Vec&lt;u8&gt;;
</code></pre>
<p>The storage in this pallet uses a map's keyset to enforce a limit of one github issue per posted bounty.</p>
<pre><code class="language-rust ignore">decl_storage!{
    /// Prevent overlapping usage of issues
    pub IssueHashSet get(fn issue_hash_set): map
        hasher(blake2_128_concat) EncodedIssue =&gt; Option&lt;()&gt;;
}
</code></pre>
<p>The first line in this method checks that the encoded issue metadata has not been associated with an another bounty on-chain.</p>
<pre><code class="language-rust ignore">ensure!(&lt;IssueHashSet&gt;::get(issue.clone()).is_none(), Error::&lt;T&gt;::IssueAlreadyClaimedForBountyOrSubmission);
</code></pre>
<p>This global hashset pattern is useful when defining a 1-to-1 mapping between an off-chain identity (e.g. unique github issue) and an on-chain object (e.g. bounty).</p>
<h3 id="contribute-to-bounties"><a class="header" href="#contribute-to-bounties">Contribute to Bounties</a></h3>
<p>Anyone can contribute to bounties. There are no refunds and there is no representation in spending governance. The only constraint is that outside contributions must exceed the module constant.</p>
<pre><code class="language-rust ignore">pub trait Trait {
    ...
    /// Minimum contribution to posted bounty
    type MinContribution: Get&lt;BalanceOf&lt;Self&gt;&gt;;
}
</code></pre>
<p>The public runtime method signature is</p>
<pre><code class="language-rust ignore">fn contribute_to_bounty(
    origin,
    bounty_id: T::BountyId,
    amount: BalanceOf&lt;T&gt;,
) -&gt; DispatchResult
</code></pre>
<p>The first line checks the amount exceeds the module constant.</p>
<pre><code class="language-rust ignore">ensure!(amount &gt;= T::MinContribution::get(), Error::&lt;T&gt;::ContributionMustExceedModuleMin);
</code></pre>
<h3 id="apply-for-bounty"><a class="header" href="#apply-for-bounty">Apply for Bounty</a></h3>
<p>Anyone except the poster can apply for a bounty. The issue associated with the application (<em>submission</em>) must be unique and independent from the bounty issue to which it is applying. Likewise, the bounty identifier that the submission references must exist in on-chain storage in order for the submission to be valid.</p>
<p>Here is the runtime method header with the checks required for valid submissions.</p>
<pre><code class="language-rust ignore">fn submit_for_bounty(
    origin,
    bounty_id: T::BountyId,
    issue: EncodedIssue,
    submission_ref: T::IpfsReference,
    amount: BalanceOf&lt;T&gt;,
) -&gt; DispatchResult {
    ensure!(&lt;IssueHashSet&gt;::get(issue.clone()).is_none(), Error::&lt;T&gt;::IssueAlreadyClaimedForBountyOrSubmission);
    let bounty = &lt;Bounties&lt;T&gt;&gt;::get(bounty_id).ok_or(Error::&lt;T&gt;::BountyDNE)?;
    let submitter = ensure_signed(origin)?;
    ensure!(submitter != bounty.depositer(), Error::&lt;T&gt;::DepositerCannotSubmitForBounty);
    ensure!(amount &lt;= bounty.total(), Error::&lt;T&gt;::BountySubmissionExceedsTotalAvailableFunding);
    ...
}
</code></pre>
<p>If any of these checks fail, the method is still safe because no storage values have been changed. This is demonstrates the <em>verify first, push to storage last</em> principle.</p>
<h3 id="approve-bounty"><a class="header" href="#approve-bounty">Approve Bounty</a></h3>
<p>Only the account that posted the bounty can approve submissions. Submission approval immediately transfers funds to the recipient.</p>
<p>Here is the runtime method header with the checks required for valid submissions.</p>
<pre><code class="language-rust ignore">fn approve_bounty_submission(
origin,
submission_id: T::SubmissionId,
) -&gt; DispatchResult {
    let approver = ensure_signed(origin)?;
    let submission = &lt;Submissions&lt;T&gt;&gt;::get(submission_id).ok_or(Error::&lt;T&gt;::SubmissionDNE)?;
    ensure!(submission.state().awaiting_review(), Error::&lt;T&gt;::SubmissionNotInValidStateToApprove);
    let bounty_id = submission.bounty_id();
    let bounty = &lt;Bounties&lt;T&gt;&gt;::get(bounty_id).ok_or(Error::&lt;T&gt;::BountyDNE)?;
    ensure!(bounty.total() &gt;= submission.amount(), Error::&lt;T&gt;::CannotApproveSubmissionIfAmountExceedsTotalAvailable);
    ensure!(bounty.depositer() == approver, Error::&lt;T&gt;::NotAuthorizedToApproveBountySubmissions);
    // execute payment
    T::Currency::transfer(
        &amp;Self::bounty_account_id(bounty_id),
        &amp;submission.submitter(),
        submission.amount(),
        ExistenceRequirement::KeepAlive,
    )?;
    ...
</code></pre>
<h3 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h3>
<p>This module works for single account governance, but isn't sufficiently expressive for democracy (direct and representative). Future versions will allow contributors to select representatives and vote to approve submissions. See the <code>grant</code> pallet for an example of an on-chain grants program that uses org voting to make grant decisions.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="org-pallet"><a class="header" href="#org-pallet">Org Pallet</a></h2>
<p>This pallet handles organization membership and governance. Each weighted group of accounts stored in this pallet has a unique <code>OrgId</code>. This identifier is often used in inheriting modules to establish ownership of the organization over associated state.</p>
<h3 id="share-ownership"><a class="header" href="#share-ownership">Share Ownership</a></h3>
<p>Each member (<code>AccountId</code>) in an org has some quantity of <code>Shares</code> in proportion to their relative ownership and voting power. This ownership metadata is stored in runtime storage like</p>
<pre><code class="language-rust ignore">double_map OrgId, AccountId =&gt; Option&lt;ShareProfile&lt;T&gt;&gt;;
</code></pre>
<p>Pallets that inherit this pallet can check membership of an <code>AccountId</code> in an <code>OrgId</code> by checking if the map associated with the key: <code>OrgId, AccountId</code> is <code>Some(ShareProfile&lt;T&gt;)</code>. There is an associated method for this purpose.</p>
<pre><code class="language-rust ignore">let auth = &lt;org::Module&lt;T&gt;&gt;::is_member_of_group(org, &amp;who);
ensure!(auth, Error::&lt;T&gt;::NotAuthorized);
</code></pre>
<h3 id="default-governance"><a class="header" href="#default-governance">Default Governance</a></h3>
<p>Every group has a sudo <code>Option&lt;AccountId&gt;</code>. This position is set in the organization state upon initialization.</p>
<pre><code class="language-rust ignore">pub struct Organization&lt;AccountId, OrgId, IpfsRef&gt; {
    /// Optional sudo, encouraged to be None
    sudo: Option&lt;AccountId&gt;,
    /// Organization identifier
    id: OrgId,
    /// The constitution
    constitution: IpfsRef,
}
</code></pre>
<p>The sudo is intended to be a representative selected by the group to <em>keep things moving</em>, but their selection will be easily revocable. The <code>rank</code> module expresses representative selection with enforced term limits for this exact purpose.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="sunshine-client"><a class="header" href="#sunshine-client">Sunshine Client</a></h1>
<p>At the core, there is a collection of crates that are shared between decoupled, composable sunshine modules. The core crates handle cryptography, codecs, communicating with the dart vm, the substrate light client and ipfs.</p>
<p>Sunshine modules have a substrate runtime component, a client component and a cli and ffi interface.</p>
<p><img src="https://draftin.com:443/images/75510?token=FlEvvHLf4Y-96u_aC6FWYchEnEu_4GRR6XihvxbWZXaWV3aPOc066yQ1IcqmtbzMz9txZL1l-hW3re7RYBOu0aM" alt="architecture.svg" /></p>
<p>The node, runtime, client and ffi is composed of sunshine modules and lives in the <a href="https://github.com/sunshine-protocol/sunshine">sunshine repo</a>. <a href="https://github.com/sunshine-protocol/sunscreen">Sunscreen</a> is our android and ios flutter ui that uses the sunshine ffi to create a mobile first user experience.</p>
<ul>
<li><a href="client/embed.html">Ipfs-Embed</a></li>
<li><a href="client/keybase.html">Keybase</a></li>
<li><a href="client/subxt.html">Substrate-Subxt</a></li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="offchain-data"><a class="header" href="#offchain-data">Offchain data</a></h2>
<p>Offchain data like user and team chains, chat messages and shared files are stored in <a href="https://github.com/ipfs-rust/ipfs-embed"><code>ipfs-embed</code></a>. Ipfs embed is a performant rust ipfs implementation focusing on providing atomic and durable transactions. It is the first implementation to take a database centric design approach. Blocks are reference counted and insertions only succeed if all the referenced blocks are in the store. Blocks are pinned to mark them as used making sure that the block and any of it's references are not garbage collected.</p>
<p>Ipfs transactions are composed of <code>insert</code>, <code>pin</code> and <code>unpin</code> operations. In a first step when executing the transaction, these operations are expanded into <code>insert</code>, <code>insert_reference</code>, <code>remove_reference</code>, <code>set_pin</code> and <code>remove</code> operations. These operations are written to a write-ahead log ensuring that they are atomic and durable. The <code>insert</code> operations are committed atomically to paritydb where the blocks are stored. Then the metadata operations <code>insert_reference</code>, <code>remove_reference</code> and <code>set_pin</code> are applied to sled which is a key/value store used for maintaining and querying the block metadata. Finally the <code>remove</code> operations are commited to paritydb and the transaction is marked as complete in the write-ahead log.
When a crash occurs and the log needs to be replayed, the following algorithm is used: If the <code>insert</code> operations didn't succeed, the transaction is aborted by removing the inserted blocks from the db. If the operations succeeded then the metadata and <code>remove</code> operations can be reapplied without adverse effects.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="keybase"><a class="header" href="#keybase">Keybase</a></h1>
<p><strong><a href="https://github.com/sunshine-protocol/sunshine-keybase"><code>sunshine-keybase</code></a></strong></p>
<h2 id="chain"><a class="header" href="#chain">Chain</a></h2>
<p>The chain module is a reusable abstraction for building private proof of authority chains using ipfs and using substrate to provide authorization and consensus on the current head of the chain. When authoring a block on ipfs a race condition can occur. Due to substrate providing a total order of transactions only one transaction will succeed in updating the head of the chain, the other client will create a new block on the head of the chain and retry the failed operation.</p>
<p><img src="https://draftin.com:443/images/75511?token=ptiW5ycSDqtNQbpH3I24_9YXQQgh2YmbFtDSIT16ZBVaHVtRgQJBeMGmk94Yo3sVGjqJKj86iTmj9y9k6AF2Ujo" alt="chain_module.svg" /> </p>
<h2 id="identity"><a class="header" href="#identity">Identity</a></h2>
<p>The keybase identity module manages the user's chain that stores the user key, device keys, password and social media accounts using the sunshine chain module. Private data shared between devices is encrypted with the user private key. When a new device is provisioned a key is generated locally on the device, and a provisioning protocol is used to communicate between the new device and the provisioning device.</p>
<p><img src="https://draftin.com:443/images/75515?token=ZVIuml8B13k3idkoLujuomRsDbSbgUGtzweL7qwj_HNDX8TYlq1iegqpvEnjVjddVdDdle57KVdD7MI7OJES5c8" alt="keybase-module.svg" /> </p>
<p>Password changes are stored encrypted in the user chain. When a device receives a block with a password change it reencrypts it's local device key using the new password. This ensures that the user only needs to remember one password.</p>
<p>Social media accounts are linked to a chain account, by submitting a proof in the social media profile and on the user's chain. Other users can find the on chain account on the social media page and verify that they are both controlled by the same cryptographic identity. This allows us to use github usernames as aliases without compromising the decentralized nature or security that blockchains provide. While resolving the social media account to an on chain identity requires the service to be online, already resolved identities are stored locally. This means that even if github is offline, transfers to already verified github accounts can be performed.</p>
<p>Finally the user and team keys will be used in other modules to send encrypted messages, share encrypted files and vote to make decisions.</p>
<h3 id="demo-instructions"><a class="header" href="#demo-instructions">Demo Instructions</a></h3>
<p>To run <code>sunshine-identity</code> locally,</p>
<ol>
<li>clone <code>sunshine-keybase</code> and build the <code>node</code> in release mode</li>
</ol>
<pre><code class="language-bash">$ git clone https://github.com/sunshine-protocol/sunshine-keybase
$ cd bin/node
$ cargo build --release
</code></pre>
<p>Once it compiles, return to root and run the node in dev mode</p>
<pre><code class="language-bash">$ cd ../../
$ ./target/release/test-node --dev
</code></pre>
<p>Use the <code>purge-chain</code> command to purge the database if you need to kill the local chain and restart.</p>
<pre><code class="language-bash">$ ./target/release/node-identity purge-chain --dev
</code></pre>
<ol start="2">
<li>Follow directions on <a href="https://github.com/sunshine-protocol/sunshine-keybase-ui"><code>sunshine-keybase-ui</code></a> README to see the Flutter UI work alongside the local test node. The interface demonstrates functionality for identity registration, password reset, and github authentication (account ownership proofs). Here is a <a href="https://www.youtube.com/watch?v=yZsXW4UlqCg">demo video</a> by <a href="https://github.com/shekohex">@shekohex</a>.</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="subxt"><a class="header" href="#subxt">subxt</a></h2>
<p><a href="https://github.com/paritytech/substrate-subxt"><code>substrate-subxt</code></a> is a rust substrate client built to interface with the substrate chain. It provides light client support, making it possible to work with untrusted substrate nodes. </p>
<p>It is unique in it's support for writing integration tests, by replacing the light client with a full node. This functionality is demonstrated in <code>sunshine-keybase</code>. </p>
<p>To see these tests in action, <a href="https://github.com/sunshine-protocol/sunshine-keybase">clone the repo</a> and run the following commands</p>
<pre><code class="language-bash">$ git clone https://github.com/sunshine-protocol/sunshine-keybase
$ cd sunshine-keybase &amp;&amp; cd chain/client
$ cargo test --release
</code></pre>
<p>Here is an example of expected output. <code>UnknownSubscriptionId</code> errors are <em><a href="https://github.com/paritytech/substrate-subxt/issues/94">usually OK</a></em>.</p>
<pre><code class="language-bash">running 3 tests
[2020-10-06T18:28:36Z ERROR jsonrpsee::client] Client Error: UnknownSubscriptionId
[2020-10-06T18:28:36Z ERROR jsonrpsee::client] Client Error: UnknownSubscriptionId
[2020-10-06T18:28:42Z ERROR jsonrpsee::client] Client Error: UnknownSubscriptionId
test tests::test_sync ... ok
test tests::test_concurrent ... ok
test tests::test_chain ... ok

test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

   Doc-tests sunshine-chain-client

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre>
<p>There are more client integration tests in <code>identity/client</code>.</p>
<pre><code class="language-bash">➜  client git:(master) cart --release
   Compiling sunshine-identity-client v0.2.3 (/Users/4meta5/sunshine-protocol/sunshine-keybase/identity/client)
    Finished release [optimized] target(s) in 29.16s
     Running /Users/4meta5/sunshine-protocol/sunshine-keybase/target/release/deps/sunshine_identity_client-d858ac81e954b312

running 4 tests
test utils::tests::parse_identifer ... ok
test client::tests::provision_device ... ok
test client::tests::change_password ... ok
test client::tests::prove_identity ... ok

test result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

   Doc-tests sunshine-identity-client

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="shared-open-problems"><a class="header" href="#shared-open-problems">Shared Open Problems</a></h1>
<p>The following open problems are shared by the Web3 space. Our ability to collaboratively fund development on critical infrastructure decides the direction of this technology.</p>
<h2 id="substrate-warp-sync"><a class="header" href="#substrate-warp-sync">Substrate Warp Sync</a></h2>
<p>Without warp sync, light clients lack functionality until they are fully synced. Sometimes this can take a really long time (we've experienced anywhere from a few hours to over a day for short-living, low throughput test networks).</p>
<p>OpenEthereum clients receive a snapshot over the network to get the full state at the latest block, and then fill in the blocks between the genesis and the snapshot in the background. The code is <a href="https://github.com/openethereum/openethereum/blob/master/ethcore/sync/src/snapshot_sync.rs">here</a>.</p>
<p>Discussion of Substrate Warp Sync <a href="https://github.com/paritytech/substrate/issues/1208">in this issue</a>.</p>
<h2 id="rust-libp2p-nat-traversal"><a class="header" href="#rust-libp2p-nat-traversal">Rust-Libp2p Nat Traversal</a></h2>
<p><strong><a href="https://github.com/w3f/General-Grants-Program/pull/327/files#diff-76eb553547b516da2ea065acc5633ca3R50">src</a></strong></p>
<p>Nat traversal and firewall traversal is required when peers want to establish a connection to each other. In a traditional server architecture the server gets a public ip like a phone number. Mobile networks or home networks share an ip address, so you can't directly connect to a device that is on a different network. This is done for multiple reasons. Since the ipv4 address space is a 4 byte number, only ~4 million devices can have a unique ip address. Today's number of devices connected to the internet vastly exceeds that amount. But even in ipv6 with a 16 byte address space that allows every device to have a unique ip, the problem of nat traversal will persist. In most cases you don't want arbitrary connections to be opened to arbitrary devices. So in ipv6 firewalls are configured to only allow outgoing connections and reject incoming connections. Techniques used for nat traversal and firewall traversal are and will remain an important part of p2p networks.</p>
<h3 id="transport-port-reusability"><a class="header" href="#transport-port-reusability">Transport Port Reusability</a></h3>
<p>Transports are assumed by libp2p to have distinct listening and dialing ports. This is an issue when trying to add the quic transport or when using tcp ports with SO_PORTREUSE. Without port reuse, nat traversal becomes impossible without a relay. For the first task, changes to libp2p-core and libp2p-swarm will be made as discussed <a href="https://github.com/libp2p/rust-libp2p/issues/1722">here</a>. The new api will be validated by adding a tcp transport that supports reusing ports and a prototype libp2p-quic crate will be released using this new api. The libp2p-quic crate will live in it's own repo until the rust-libp2p team has the time to review and merge the new transport. Extensive work on the quic transport has already been done by parity employees, but without these api changes it will remain a second class citizen.</p>
<h3 id="libp2p-relay"><a class="header" href="#libp2p-relay">Libp2p Relay</a></h3>
<p>Implement the libp2p relay protocol including tests and examples, showing how to use a third party to establish a connection between two peers that cannot communicate because of a local nat or firewall. Deliverables will be a working libp2p-relay crate. The netsim-embed network simulator we developed will help writing automated tests to verify that it functions correctly.</p>
<h2 id="rust-substrate-client"><a class="header" href="#rust-substrate-client">Rust Substrate Client</a></h2>
<p>Substrate is written in Rust for a reason; the requirements for blockchain technology align with Rust's dual promise of speed and safety. These requirements extend to the client and make Rust the most practical language for building high-performance, secure clients.</p>
<p>An efficient Rust Substrate client would be able to subscribe to updates only relevant to the client's authorized account(s). Moreover, a well-designed Substrate Rust client would be able to use type metadata to dynamically decode relevant storage data for user display. Although we're not quite there yet, that's the intended direction of <a href="https://github.com/paritytech/substrate-subxt"><code>substrate-subxt</code></a>.</p>
<p>As users of <code>substrate-subxt</code>, Sunshine developers contribute upstream often. The <code>sunshine-keybase</code> repo demonstrates integration of substrate-subxt for the Rust client implementation.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
